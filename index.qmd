---
title: "델리민주 유튜브 대시보드"
format: 
  dashboard:
    logo: assets/daily_minju.jpg
    orientation: rows
editor_options: 
  chunk_output_type: console
---

{{< include channel.qmd >}}

# 댓글

```{r}
library(readr)

comments_tbl <- read_csv("data/comments_raw.csv")

## 댓글 사용자수 ----------------
number_of_users <- comments_tbl |> 
  count(authorDisplayName, id, sort = TRUE) |> 
  nrow()

## 댓글수 ----------------
number_of_comments <- comments_tbl |> 
  nrow()

## 비디오수 ----------------
number_of_videos <- comments_tbl |> 
  count(videoId) |>
  nrow()
```


## Row

```{r}
#| content: valuebox
#| title: "댓글 사람수"

list(
  icon = "hospital",
  color = "yellow",
  value = number_of_users
)
```

```{r}
#| content: valuebox
#| title: "댓글수"

list(
  icon = "moon-fill",
  color = "danger",
  value = number_of_comments
)
```


```{r}
#| content: valuebox
#| title: "비디오수"

list(
  icon = "heart-fill",
  color = "green",
  value = number_of_videos
)
```

## Column

::: {.card}

```{r}
library(reactable)


comments_tbl |> 
  arrange(desc(publishedAt)) |> 
  mutate(게시일 = floor_date(publishedAt, unit = "day") |> as.Date()) |> 
  select(vidoe_id = videoId, 댓글=textOriginal, 게시일, 좋아요수=likeCount) |> 
  reactable(
      searchable = TRUE,
      defaultColDef = colDef(
        header = function(value) gsub(".", " ", value, fixed = TRUE),
        align = "center",
        minWidth = 30,
        headerStyle = list(background = "#f7f7f8")
      ),
      columns = list(
        댓글 = colDef(minWidth = 80),
        게시일 = colDef(show = TRUE),
        좋아요수 = colDef(format = colFormat(separators = TRUE,  digits = 0)),
        vidoe_id = colDef(html = TRUE, cell = JS("
          function(cellInfo) {
            // Render as a link
            return '<a href=https://www.youtube.com//watch?v=' + cellInfo.value + '/>' + cellInfo.value + '</a>'
          }"))
      ),
      bordered = TRUE,
      highlight = TRUE    
  )

```


:::

::: {.card}

```{r}
comments_g <- comments_tbl |> 
  group_by(videoId) |>
  summarise(좋아요수 = sum(likeCount),
            댓글수   = n()) |> 
  ungroup() |> 
  ggplot(aes(x = 댓글수, y = 좋아요수,
             text = str_glue("{videoId}"))) +
    geom_point() +
    scale_x_sqrt(labels = scales::comma) +
    scale_y_sqrt(labels = scales::comma) +
    theme(legend.position = "none") +
    labs(title = "동영상 별 댓글수와 좋아요수 관계") 
  
plotly::ggplotly(comments_g, tooltip = "text")
```


:::
